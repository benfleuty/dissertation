@using System.Text.RegularExpressions;
@using FluentFTP;
@using System.Text;
@using RabbitMQ.Client;
@using RabbitMQ.Client.Events;
@using UploadedFilesLibrary;
@using TranscodeNowWebServer.Data
@inject IJSRuntime JSRuntime
@inject Microsoft.AspNetCore.Hosting.IWebHostEnvironment env
@inject NavigationManager nav
@inject IConfiguration config
@inject ISqlDataAccess sql

<link rel="stylesheet" href="css/dragAndDrop.css" />

<div @ref="@dragAndDropContainer" class="drop-zone w-100">
    <form>
        <div @ref="@fileUploadControl">
            <p class="upload-step text-center">Step 1</p>
            <label for="fileInput" class="visually-hidden">Choose your file:</label>
            <InputFile id="fileInput" OnChange="@OnChange" class="form-control" />
            <p class="text-center opacity-75">Or drop a file here</p>
            @if (file is not null)
            {
                string article = "a";
                if (new[] { 'a', 'e', 'i', 'o', 'u' }.Contains(char.ToLower(uploadedFileMime.type[0])))
                {
                    article = "an";
                }
                <p>
                    You have selected @article @uploadedFileMime.type file.
                </p>
                if (uploadedFileMime.IsSupported == false)
                {
                    <p class="text-danger">
                        This file type is not supported! Please select an audio or video file.
                    </p>
                }

            }
        </div>
        @if (file is not null && uploadedFileMime.IsSupported)
        {
            <div class="mt-4">
                <p class="upload-step text-center">Step 2</p>
                <label for="btnUpload" class="visually-hidden">Click here to upload your file:</label>
                <button class="btn btn-primary my-2 form-control" @onclick="BtnUploadFile" type="button" disabled="@DisableUploadButton">Upload</button>
            </div>
        }
    </form>

    @if (Progress is not null)
    {
        <div class="mt-4">
            <p class="progress-step text-center">Step 3</p>

            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: @Progress%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">@Progress</div>
            </div>
        </div>
    }

    @if (ErrorMessage is not null)
    {
        
        <div class="mt-4 mx-2 bg-danger">
            <p class="">Something went wrong!</p>

            <div class="error-text">
                <p>@ErrorMessage</p>
            </div>
        </div>
    }
</div>

